# ç¼–è¾‘å™¨ä¸å¼€å‘åè®®å­¦ä¹ ç¬”è®°

> 100 å¤©è®¤çŸ¥æå‡è®¡åˆ’ | Day 1

---

## ç›®å½•

- [ç¬¬ä¸€éƒ¨åˆ†ï¼šLSP è¯­è¨€æœåŠ¡å™¨åè®®](#ç¬¬ä¸€éƒ¨åˆ†lsp-è¯­è¨€æœåŠ¡å™¨åè®®)
  - [LSP æ¦‚è¿°](#lsp-æ¦‚è¿°)
  - [é€šä¿¡åŸç†](#é€šä¿¡åŸç†)
  - [JSON-RPC æ¶ˆæ¯æ ¼å¼](#json-rpc-æ¶ˆæ¯æ ¼å¼)
  - [å¼€å‘ LSP æœåŠ¡å™¨](#å¼€å‘-lsp-æœåŠ¡å™¨)
- [ç¬¬äºŒéƒ¨åˆ†ï¼šDAP è°ƒè¯•é€‚é…å™¨åè®®](#ç¬¬äºŒéƒ¨åˆ†dap-è°ƒè¯•é€‚é…å™¨åè®®)
  - [DAP æ¦‚è¿°](#dap-æ¦‚è¿°)
  - [ä¸ LSP çš„å…³ç³»](#ä¸-lsp-çš„å…³ç³»)
  - [è°ƒè¯•æµç¨‹](#è°ƒè¯•æµç¨‹)
  - [è¿œç¨‹è°ƒè¯•](#è¿œç¨‹è°ƒè¯•)
- [ç¬¬ä¸‰éƒ¨åˆ†ï¼šå®è·µä¸æ€è€ƒ](#ç¬¬ä¸‰éƒ¨åˆ†å®è·µä¸æ€è€ƒ)

---

## ç¬¬ä¸€éƒ¨åˆ†ï¼šLSP è¯­è¨€æœåŠ¡å™¨åè®®

### LSP æ¦‚è¿°

**ä»€ä¹ˆæ˜¯ LSP**

LSP (Language Server Protocol) æ˜¯å¾®è½¯å¼€å‘çš„é€šä¿¡åè®®ï¼Œç°å·²æˆä¸ºä¸šç•Œæ ‡å‡†ã€‚å®ƒè§£å†³äº†ç¼–è¾‘å™¨å¯¹ç¼–ç¨‹è¯­è¨€æ”¯æŒçš„é‡å¤å¼€å‘é—®é¢˜ã€‚

**æ ¸å¿ƒä»·å€¼ï¼šä» NÃ—M åˆ° N+M**

| ä¼ ç»Ÿæ¨¡å¼ | LSP æ¨¡å¼ |
|---------|---------|
| N ä¸ªç¼–è¾‘å™¨ Ã— M ç§è¯­è¨€ = **NÃ—M** ä¸ªå®ç° | N ä¸ªç¼–è¾‘å™¨ + M ä¸ªè¯­è¨€æœåŠ¡å™¨ = **N+M** ä¸ªå®ç° |

**æä¾›çš„èƒ½åŠ›**

| åŠŸèƒ½ | è¯´æ˜ |
|------|------|
| ä»£ç è¡¥å…¨ | Autocomplete |
| è·³è½¬åˆ°å®šä¹‰ | Go to Definition |
| æŸ¥æ‰¾å¼•ç”¨ | Find References |
| æ‚¬åœæç¤º | Hover Information |
| ä»£ç è¯Šæ–­ | Diagnostics |
| é‡å‘½åé‡æ„ | Rename Symbol |
| ä»£ç æ ¼å¼åŒ– | Formatting |

**å¸¸è§è¯­è¨€æœåŠ¡å™¨**

| è¯­è¨€ | æœåŠ¡å™¨ |
|------|--------|
| TypeScript | typescript-language-server |
| Go | gopls |
| Rust | rust-analyzer |
| Python | pylspã€pyright |

---

### é€šä¿¡åŸç†

**æ¶æ„å›¾**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      LSP (JSON-RPC)      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç¼–è¾‘å™¨     â”‚  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  â”‚    è¯­è¨€æœåŠ¡å™¨    â”‚
â”‚ (VS Codeç­‰) â”‚   è¯·æ±‚/å“åº”/é€šçŸ¥          â”‚ (tsserver/gopls)â”‚
â”‚             â”‚                          â”‚                 â”‚
â”‚   â€¢ UI      â”‚                          â”‚   â€¢ ä»£ç åˆ†æ     â”‚
â”‚   â€¢ æ–‡æœ¬ç¼–è¾‘ â”‚                          â”‚   â€¢ è¯­æ³•è§£æ     â”‚
â”‚   â€¢ æ¸²æŸ“    â”‚                          â”‚   â€¢ ç±»å‹æ¨æ–­     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è§£è€¦è®¾è®¡**

- **ç¼–è¾‘å™¨ï¼ˆå®¢æˆ·ç«¯ï¼‰**ï¼šåªè´Ÿè´£ UI å’Œæ–‡æœ¬ç¼–è¾‘
- **è¯­è¨€æœåŠ¡å™¨ï¼ˆæœåŠ¡ç«¯ï¼‰**ï¼šè´Ÿè´£ä»£ç åˆ†æã€æ™ºèƒ½æç¤ºç­‰
- **é€šä¿¡åè®®**ï¼šJSON-RPC 2.0

---

### JSON-RPC æ¶ˆæ¯æ ¼å¼

LSP/DAP åŸºäº JSON-RPC 2.0ï¼Œæœ‰ä¸‰ç§æ¶ˆæ¯ç±»å‹ï¼š

#### 1. Request / Responseï¼ˆè¯·æ±‚-å“åº”ï¼‰

**è¯·æ±‚ç¤ºä¾‹ï¼šç¼–è¾‘å™¨è¯·æ±‚è¡¥å…¨**

```json
{
  "jsonrpc": "2.0",
  "id": 1,
  "method": "textDocument/completion",
  "params": {
    "textDocument": { "uri": "file:///path/to/file.ts" },
    "position": { "line": 5, "character": 10 }
  }
}
```

**å“åº”ç¤ºä¾‹ï¼šæœåŠ¡å™¨è¿”å›è¡¥å…¨åˆ—è¡¨**

```json
{
  "jsonrpc": "2.0",
  "id": 1,
  "result": {
    "items": [
      { "label": "console", "kind": 3, "detail": "var console: Console" },
      { "label": "const", "kind": 14, "detail": "keyword" }
    ]
  }
}
```

#### 2. Notificationï¼ˆé€šçŸ¥ï¼Œå•å‘ï¼‰

**ç¼–è¾‘å™¨é€šçŸ¥æœåŠ¡å™¨æ–‡ä»¶å·²æ‰“å¼€**

```json
{
  "jsonrpc": "2.0",
  "method": "textDocument/didOpen",
  "params": {
    "textDocument": {
      "uri": "file:///path/to/file.ts",
      "languageId": "typescript",
      "version": 1,
      "text": "const x = 1;"
    }
  }
}
```

**æœåŠ¡å™¨é€šçŸ¥ç¼–è¾‘å™¨æœ‰é”™è¯¯**

```json
{
  "jsonrpc": "2.0",
  "method": "textDocument/publishDiagnostics",
  "params": {
    "uri": "file:///path/to/file.ts",
    "diagnostics": [
      {
        "range": { "start": {"line": 0, "character": 8}, "end": {"line": 0, "character": 9} },
        "severity": 1,
        "message": "Cannot find name 'x'"
      }
    ]
  }
}
```

#### æ¶ˆæ¯ç±»å‹å¯¹æ¯”

| ç±»å‹ | å­—æ®µç‰¹å¾ | æ˜¯å¦éœ€è¦å“åº” | å…¸å‹åœºæ™¯ |
|------|---------|-------------|---------|
| **Request** | æœ‰ `id` | âœ… æ˜¯ | è·å–è¡¥å…¨ã€è·³è½¬å®šä¹‰ |
| **Response** | æœ‰ `id`ã€`result` | - | è¿”å›è¯·æ±‚ç»“æœ |
| **Notification** | æ—  `id` | âŒ å¦ | æ–‡ä»¶å˜æ›´ã€é”™è¯¯é€šçŸ¥ |

---

### å¼€å‘ LSP æœåŠ¡å™¨

#### æŠ€æœ¯é€‰å‹

| è¯­è¨€ | æ¨èæ¡†æ¶ |
|------|---------|
| TypeScript | `vscode-languageserver`ã€`langium` |
| Python | `pygls` |
| Go | `gopls/langserver` |
| Rust | `tower-lsp` |

#### æœ€å°å®ç°ç¤ºä¾‹ï¼ˆPython + pyglsï¼‰

```python
from pygls.server import LanguageServer
from pygls.lsp import CompletionItem, CompletionItemKind

# åˆ›å»ºæœåŠ¡å™¨å®ä¾‹
server = LanguageServer()

# æ³¨å†Œè¡¥å…¨å¤„ç†å™¨
@server.feature("textDocument/completion")
def completions(params):
    return [
        CompletionItem(label="hello", kind=CompletionItemKind.Text),
        CompletionItem(label="world", kind=CompletionItemKind.Text),
    ]

# å¯åŠ¨æœåŠ¡å™¨
server.start_io()
```

#### å¼€å‘æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å®šä¹‰è¯­è¨€èƒ½åŠ› â”‚ â”€â”€â–º â”‚ å®ç°å¤„ç†å™¨   â”‚ â”€â”€â–º â”‚  æµ‹è¯•éªŒè¯   â”‚ â”€â”€â–º â”‚  æ‰“åŒ…å‘å¸ƒ   â”‚
â”‚ (capabilities)â”‚     â”‚ (handlers)  â”‚     â”‚ (VS Codeç­‰) â”‚     â”‚ (npm/pip)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### å¿…é¡»å®ç°çš„åŸºç¡€èƒ½åŠ›

| æ–¹æ³• | è¯´æ˜ | ä¼˜å…ˆçº§ |
|------|------|--------|
| `initialize` | è¿”å›æœåŠ¡å™¨èƒ½åŠ› | ğŸ”´ å¿…é¡» |
| `initialized` | å®¢æˆ·ç«¯åˆå§‹åŒ–å®Œæˆé€šçŸ¥ | ğŸ”´ å¿…é¡» |
| `shutdown` | å…³é—­è¯·æ±‚ | ğŸ”´ å¿…é¡» |
| `textDocument/didOpen` | æ–‡æ¡£æ‰“å¼€ | ğŸŸ¡ é«˜ |
| `textDocument/didChange` | æ–‡æ¡£å˜æ›´ | ğŸŸ¡ é«˜ |
| `textDocument/completion` | ä»£ç è¡¥å…¨ | ğŸŸ¡ é«˜ |

---

## ç¬¬äºŒéƒ¨åˆ†ï¼šDAP è°ƒè¯•é€‚é…å™¨åè®®

### DAP æ¦‚è¿°

**ä»€ä¹ˆæ˜¯ DAP**

DAP (Debug Adapter Protocol) ä¸ LSP å¸ˆå‡ºåŒé—¨ï¼Œè§£å†³ç¼–è¾‘å™¨å¯¹è°ƒè¯•å™¨æ”¯æŒçš„é‡å¤å¼€å‘é—®é¢˜ã€‚

**å¸¸è§ Debug Adapter**

| è¯­è¨€/ç¯å¢ƒ | Debug Adapter |
|-----------|---------------|
| Go | delve |
| Python | debugpy |
| Node.js | node-debug2 |
| C++ | cpptools (gdb/lldb) |
| Rust | lldb-dap / codelldb |

---

### ä¸ LSP çš„å…³ç³»

**ç±»æ¯”å…³ç³»**

| LSP | DAP |
|-----|-----|
| ä»£ç ç¼–è¾‘æ”¯æŒ | è°ƒè¯•æ”¯æŒ |
| Language Server | Debug Adapter |
| è¡¥å…¨ã€è·³è½¬ã€è¯Šæ–­ | æ–­ç‚¹ã€å•æ­¥ã€å˜é‡æŸ¥çœ‹ |

**DAP å·¥ä½œåŸç†**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      DAP (JSON-RPC)      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç¼–è¾‘å™¨     â”‚  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  â”‚   Debug Adapter  â”‚
â”‚ (VS Codeç­‰) â”‚   è¯·æ±‚/å“åº”/äº‹ä»¶          â”‚ (gdb/lldb/dlv)   â”‚
â”‚             â”‚                          â”‚                 â”‚
â”‚   â€¢ æ–­ç‚¹ UI â”‚                          â”‚   â€¢ æ§åˆ¶æ‰§è¡Œ     â”‚
â”‚   â€¢ å˜é‡é¢æ¿ â”‚                          â”‚   â€¢ è¯»å–å†…å­˜     â”‚
â”‚   â€¢ è°ƒç”¨æ ˆ  â”‚                          â”‚   â€¢ å•æ­¥æ‰§è¡Œ     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                   â”‚
                                                   â–¼
                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                          â”‚    è¢«è°ƒè¯•ç¨‹åº     â”‚
                                          â”‚  (ç›®æ ‡è¿›ç¨‹)      â”‚
                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### è°ƒè¯•æµç¨‹

**æ ¸å¿ƒåŠŸèƒ½**

| åŠŸèƒ½ | è¯´æ˜ |
|------|------|
| **æ–­ç‚¹ç®¡ç†** | è®¾ç½®/åˆ é™¤æ–­ç‚¹ï¼Œæ”¯æŒæ¡ä»¶æ–­ç‚¹ |
| **æ­¥è¿›æ§åˆ¶** | Step Overã€Step Intoã€Step Out |
| **å †æ ˆè¿½è¸ª** | æŸ¥çœ‹è°ƒç”¨æ ˆï¼Œåœ¨æ ˆå¸§é—´åˆ‡æ¢ |
| **å˜é‡æŸ¥çœ‹** | å±€éƒ¨å˜é‡ã€ç›‘è§†è¡¨è¾¾å¼ã€æ±‚å€¼ |
| **å¼‚å¸¸å¤„ç†** | æ•è·å¼‚å¸¸æ—¶æš‚åœ |

**è°ƒè¯•æµç¨‹å›¾**

```
     å¯åŠ¨é˜¶æ®µ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ launch/attach â†’ initialize â†’ setBreakpoints      â”‚
â”‚           â†“                                      â”‚
â”‚    configurationDone                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
              è°ƒè¯•å¾ªç¯
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ continue â†’ stoppedäº‹ä»¶ â†’ æŸ¥çœ‹çŠ¶æ€ â†’ step/continue â”‚
â”‚     â†‘                                    â†“      â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ å¾ªç¯ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### è¿œç¨‹è°ƒè¯•

**æ¶æ„ç¤ºæ„**

```
æœ¬åœ°å¼€å‘ç¯å¢ƒ                    è¿œç¨‹æœåŠ¡å™¨
    â”‚                              â”‚
    â”‚  DAP over TCP/SSH           â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
    â”‚                          â”Œâ”€â”€â”€â”´â”€â”€â”€â”
    â”‚                          â”‚  DAP   â”‚
    â”‚                          â”‚ Server â”‚
    â”‚                          â””â”€â”€â”€â”¬â”€â”€â”€â”˜
    â”‚                          â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚                          â”‚ Target â”‚
    â”‚                          â”‚  ç¨‹åº   â”‚
    â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¸¤ç§æ¨¡å¼**

| æ¨¡å¼ | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|------|------|---------|
| **attach** | è¿æ¥åˆ°å·²è¿è¡Œçš„è¿œç¨‹è¿›ç¨‹ | ç¨‹åºå·²åœ¨æœåŠ¡å™¨è¿è¡Œ |
| **remote launch** | å¯åŠ¨è¿œç¨‹ç¨‹åºå¹¶è°ƒè¯• | ä»æœ¬åœ°å¯åŠ¨è¿œç¨‹ç¨‹åº |

**VS Code é…ç½®ç¤ºä¾‹**

```json
{
  "type": "python",
  "request": "attach",
  "name": "Remote Attach",
  "connect": { "host": "remote-server.com", "port": 5678 },
  "pathMappings": [
    { "localRoot": "${workspaceFolder}", "remoteRoot": "/app" }
  ]
}
```

**å…³é”®é…ç½®é¡¹**

| é…ç½® | ä½œç”¨ |
|------|------|
| `connect.host` | è¿œç¨‹æœåŠ¡å™¨åœ°å€ |
| `connect.port` | DAP Server ç›‘å¬ç«¯å£ |
| `pathMappings` | æœ¬åœ°è·¯å¾„ â†” è¿œç¨‹è·¯å¾„æ˜ å°„ |
| `reverseListen` | åå‘è¿æ¥ï¼ˆè¿œç¨‹ä¸»åŠ¨è¿æ¥æœ¬åœ°ï¼‰ |

**è¿œç¨‹è°ƒè¯•ä¸‰æ­¥èµ°**

```
Step 1: è¿œç¨‹å¯åŠ¨ DAP Server
â””â”€â–ª debugpy --listen 0.0.0.0:5678 --wait-for-client

Step 2: æœ¬åœ° SSH éš§é“è½¬å‘ï¼ˆå¯é€‰ï¼‰
â””â”€â–ª ssh -L 5678:localhost:5678 user@remote

Step 3: ç¼–è¾‘å™¨è¿æ¥
â””â”€â–ª attach åˆ° localhost:5678
```

---

## ç¬¬ä¸‰éƒ¨åˆ†ï¼šå®è·µä¸æ€è€ƒ

### å®è·µè®°å½•

**LSP é…ç½®**

- [ ] å®‰è£… Neovim 0.10+
- [ ] é…ç½®ä¸»è¦è¯­è¨€çš„ LSPï¼ˆGo/Python/TypeScriptï¼‰
- [ ] æµ‹è¯•ä»£ç è¡¥å…¨ã€è·³è½¬å®šä¹‰ã€æ‚¬åœæç¤º

**DAP é…ç½®**

- [ ] å®‰è£… nvim-dap
- [ ] å®‰è£…å¯¹åº”è¯­è¨€çš„ Debug Adapter
- [ ] æµ‹è¯•æ–­ç‚¹ã€å•æ­¥æ‰§è¡Œã€å˜é‡æŸ¥çœ‹

---

### ç–‘é—®ä¸æ€è€ƒ

**å·²è§£ç­”**

1. âœ… LSP ä½¿ç”¨ JSON-RPC é€šä¿¡ï¼Œå…·ä½“çš„æ¶ˆæ¯æ ¼å¼æ˜¯æ€æ ·çš„ï¼Ÿ
2. âœ… å¦‚ä½•ä¸ºä¸€ç§æ–°è¯­è¨€å¼€å‘ LSP æœåŠ¡å™¨ï¼Ÿ
3. âœ… LSP å’Œ DAP çš„å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿ
4. âœ… DAP å¦‚ä½•å¤„ç†è¿œç¨‹è°ƒè¯•åœºæ™¯ï¼Ÿ

**å¾…æ¢ç´¢**

5. â“ å¦‚ä½•ä¸ºè‡ªå®šä¹‰è°ƒè¯•å™¨å¼€å‘ DAP Adapterï¼Ÿ
6. â“ DAP ä¸ CRIU (Checkpoint/Restore) ç»“åˆå¯ä»¥å®ç°è¿›ç¨‹å¿«ç…§è°ƒè¯•å—ï¼Ÿ

---

*æ›´æ–°æ—¥æœŸï¼š2026-02-10*
